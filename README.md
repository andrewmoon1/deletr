Credit due to https://gist.github.com/andybeak/602611212950559df9c102b0d1ae20c7, but I had to make minor changes to get it to work.